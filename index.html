<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crispy Chicken Management Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #c0392b 0%, #e74c3c 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            font-size: 2.8rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }
        
        .subtitle {
            text-align: center;
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .card-title {
            font-size: 1.4rem;
            color: #2c3e50;
            font-weight: 600;
        }
        
        .kpi {
            font-size: 2.2rem;
            font-weight: 700;
            color: #e74c3c;
            margin-bottom: 8px;
        }
        
        .kpi-label {
            color: #7f8c8d;
            font-size: 0.95rem;
        }
        
        .chart-container {
            position: relative;
            height: 320px;
            margin-top: 20px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 25px;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        
        .data-table th, .data-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .data-table th {
            background-color: #e74c3c;
            color: white;
            font-weight: 600;
            font-size: 1rem;
        }
        
        .data-table tr:hover {
            background-color: #f9f9f9;
        }
        
        .data-table tr.editable:hover {
            background-color: #fff3cd;
            cursor: pointer;
        }
        
        .recommendations {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-top: 35px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        
        .recommendation-item {
            background: linear-gradient(to right, #fff5f5, #ffffff);
            border-left: 5px solid #e74c3c;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 0 8px 8px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .recommendation-item:hover {
            transform: translateX(5px);
        }
        
        .recommendation-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 35px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #e74c3c;
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 1.1rem;
            font-weight: 500;
        }
        
        .section {
            margin-bottom: 45px;
        }
        
        .section-title {
            font-size: 2rem;
            color: #2c3e50;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #e74c3c;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .section-icon {
            background: #e74c3c;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .highlight-box {
            background: linear-gradient(135deg, #fff5f5 0%, #ffffff 100%);
            border: 2px solid #e74c3c;
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.1);
        }
        
        .highlight-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #e74c3c;
            margin-bottom: 15px;
        }
        
        .offer-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 10px;
            color: white;
        }
        
        .offer-ultimate {
            background-color: #3498db;
        }
        
        .offer-chicken {
            background-color: #f39c12;
        }
        
        .offer-none {
            background-color: #95a5a6;
        }
        
        .positive-change {
            color: #27ae60;
            font-weight: 600;
        }
        
        .negative-change {
            color: #e74c3c;
            font-weight: 600;
        }
        
        .neutral-change {
            color: #7f8c8d;
        }
        
        .insight-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 10px;
            background: rgba(255,255,255,0.7);
            border-radius: 8px;
        }
        
        .insight-icon {
            margin-right: 12px;
            font-size: 1.2rem;
        }
        
        .toggle-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(231, 76, 60, 0.2);
        }
        
        .toggle-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(231, 76, 60, 0.3);
        }
        
        .performance-indicator {
            display: inline-flex;
            align-items: center;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .performance-high {
            background-color: #d4edda;
            color: #155724;
        }
        
        .performance-medium {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .performance-low {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        /* Data Management Section */
        .data-management {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 35px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        
        .data-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-add {
            background: #27ae60;
            color: white;
        }
        
        .btn-add:hover {
            background: #219a52;
            transform: translateY(-2px);
        }
        
        .btn-clear {
            background: #e74c3c;
            color: white;
        }
        
        .btn-clear:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        
        .btn-export {
            background: #3498db;
            color: white;
        }
        
        .btn-export:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            animation: slideIn 0.3s;
        }
        
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .modal-title {
            font-size: 1.5rem;
            color: #2c3e50;
            font-weight: 600;
        }
        
        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .close:hover {
            color: #e74c3c;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .form-label {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .form-input {
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #e74c3c;
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }
        
        .btn-save {
            background: #27ae60;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-save:hover {
            background: #219a52;
            transform: translateY(-2px);
        }
        
        .btn-cancel {
            background: #95a5a6;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-cancel:hover {
            background: #7f8c8d;
            transform: translateY(-2px);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1001;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: #27ae60;
        }
        
        .notification.error {
            background: #e74c3c;
        }
        
        .notification.info {
            background: #3498db;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Crispy Chicken Management Dashboard</h1>
            <p class="subtitle">Weekly Performance Analysis & Strategic Insights</p>
        </div>
    </header>
    
    <div class="container">
        <!-- Data Management Section -->
        <div class="data-management">
            <h2 class="section-title">
                <div class="section-icon">⚙️</div>
                Data Management
            </h2>
            <div class="data-actions">
                <button class="action-btn btn-add" id="addDataBtn">
                    <span>➕</span> Add New Data
                </button>
                <button class="action-btn btn-clear" id="clearDataBtn">
                    <span>🗑️</span> Clear All Data
                </button>
                <button class="action-btn btn-export" id="exportDataBtn">
                    <span>📥</span> Export Data
                </button>
            </div>
        </div>
        
        <!-- Executive Summary -->
        <div class="section">
            <h2 class="section-title">
                <div class="section-icon">📊</div>
                Executive Summary
            </h2>
            <div class="dashboard-grid">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Total Revenue</h3>
                    </div>
                    <div class="kpi">AED 697,834.65</div>
                    <div class="kpi-label">Across 6-week period</div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Average Weekly Sales</h3>
                    </div>
                    <div class="kpi">AED 116,305.78</div>
                    <div class="kpi-label">During promotion weeks</div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Total Orders</h3>
                    </div>
                    <div class="kpi">18,991</div>
                    <div class="kpi-label">Average: 3,165/week</div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Best Performance</h3>
                    </div>
                    <div class="kpi">Sep 15/16</div>
                    <div class="kpi-label">Chicken Day Offer: AED 155,137</div>
                </div>
            </div>
        </div>
        
        <!-- Performance Analysis -->
        <div class="section">
            <h2 class="section-title">
                <div class="section-icon">📈</div>
                Performance Analysis
            </h2>
            <div class="highlight-box">
                <div class="highlight-title">Key Management Insights</div>
                <div class="insight-item">
                    <span class="insight-icon">🔥</span>
                    <span><strong>High Dependency on Promotions:</strong> 55.5% sales drop during non-promotion week indicates strong customer reliance on offers</span>
                </div>
                <div class="insight-item">
                    <span class="insight-icon">💰</span>
                    <span><strong>NOON Channel Dominance:</strong> 73% of total sales but with high volatility (-68.8% from peak to lowest)</span>
                </div>
                <div class="insight-item">
                    <span class="insight-icon">🍗</span>
                    <span><strong>Chicken Day Offer Superiority:</strong> Highest sales performance (AED 155,137) with best conversion rate</span>
                </div>
                <div class="insight-item">
                    <span class="insight-icon">📱</span>
                    <span><strong>ONLINE Channel Underutilized:</strong> Only 7% of sales despite lowest volatility, indicating growth opportunity</span>
                </div>
            </div>
        </div>
        
        <!-- Sales Performance Charts -->
        <div class="section">
            <h2 class="section-title">
                <div class="section-icon">📊</div>
                Sales Performance
            </h2>
            <div class="dashboard-grid">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Revenue Trend</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="revenueTrend"></canvas>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Payment Channel Distribution</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="channelDistribution"></canvas>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Weekly Performance by Channel</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="weeklyChannelPerformance"></canvas>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Offer Effectiveness Analysis</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="offerEffectiveness"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Statistical Analysis -->
        <div class="section">
            <h2 class="section-title">
                <div class="section-icon">📊</div>
                Statistical Analysis
            </h2>
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-value">73%</div>
                    <div class="stat-label">NOON Sales Contribution</div>
                    <div style="margin-top: 10px; font-size: 0.9rem; color: #7f8c8d;">High volatility channel</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">15%</div>
                    <div class="stat-label">Delivery Sales Contribution</div>
                    <div style="margin-top: 10px; font-size: 0.9rem; color: #7f8c8d;">Moderate stability</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">7%</div>
                    <div class="stat-label">ONLINE Sales Contribution</div>
                    <div style="margin-top: 10px; font-size: 0.9rem; color: #7f8c8d;">Highest stability, lowest volatility</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">55.5%</div>
                    <div class="stat-label">Sales Drop Without Offers</div>
                    <div style="margin-top: 10px; font-size: 0.9rem; color: #7f8c8d;">Critical business risk</div>
                </div>
            </div>
        </div>
        
        <!-- Data Table -->
        <div class="section">
            <h2 class="section-title">
                <div class="section-icon">📋</div>
                Detailed Sales Data
            </h2>
            <div class="card">
                <button class="toggle-btn" id="toggleTable">Show/Hide Data Table</button>
                <div id="dataTableContainer" style="display: none; margin-top: 25px;">
                    <table class="data-table" id="salesDataTable">
                        <thead>
                            <tr>
                                <th>Week</th>
                                <th>Offer Type</th>
                                <th>NOON (Sales/Orders)</th>
                                <th>Delivery (Sales/Orders)</th>
                                <th>ONLINE (Sales/Orders)</th>
                                <th>Total Sales (AED)</th>
                                <th>Total Orders</th>
                                <th>Change</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="dataTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Strategic Recommendations -->
        <div class="section">
            <h2 class="section-title">
                <div class="section-icon">🎯</div>
                Strategic Recommendations
            </h2>
            <div class="recommendations">
                <div class="recommendation-item">
                    <div class="recommendation-title">Promotional Strategy Optimization</div>
                    <p><strong>Priority: High</strong> - Implement bi-weekly promotion cycles without gaps. Chicken Day Offers show 7.3% growth over Ultimate Offers. Consider creating a promotion calendar with alternating offer types to maintain customer engagement and revenue stability.</p>
                    <div style="margin-top: 10px;">
                        <span class="performance-indicator performance-high">Expected Impact: +25% revenue</span>
                    </div>
                </div>
                
                <div class="recommendation-item">
                    <div class="recommendation-title">NOON Channel Risk Management</div>
                    <p><strong>Priority: Critical</strong> - Develop contingency strategies for NOON channel volatility. Implement loyalty programs and tiered discounts to stabilize NOON sales during non-promotion periods. Consider diversifying payment options to reduce dependency on single channel.</p>
                    <div style="margin-top: 10px;">
                        <span class="performance-indicator performance-medium">Expected Impact: -15% volatility</span>
                    </div>
                </div>
                
                <div class="recommendation-item">
                    <div class="recommendation-title">ONLINE Channel Growth Initiative</div>
                    <p><strong>Priority: High</strong> - Launch targeted digital marketing campaigns to increase ONLINE channel adoption. Develop exclusive online offers and implement a seamless mobile checkout experience. The ONLINE channel's low volatility presents an opportunity for stable revenue growth.</p>
                    <div style="margin-top: 10px;">
                        <span class="performance-indicator performance-high">Expected Impact: +200% ONLINE sales</span>
                    </div>
                </div>
                
                <div class="recommendation-item">
                    <div class="recommendation-title">Operational Efficiency Improvements</div>
                    <p><strong>Priority: Medium</strong> - Align inventory and staffing with promotional calendar. Implement dynamic pricing strategies for post-promotion periods to maintain sales momentum. Develop real-time analytics dashboard for daily performance monitoring.</p>
                    <div style="margin-top: 10px;">
                        <span class="performance-indicator performance-medium">Expected Impact: +10% operational efficiency</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Entry Modal -->
    <div id="dataModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Add New Data</h3>
                <span class="close" id="closeModal">&times;</span>
            </div>
            <form id="dataForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" for="weekInput">Week</label>
                        <input type="text" class="form-input" id="weekInput" placeholder="e.g., Oct 14/15" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="offerInput">Offer Type</label>
                        <select class="form-input" id="offerInput" required>
                            <option value="">Select Offer Type</option>
                            <option value="Ultimate Offer">Ultimate Offer</option>
                            <option value="Chicken Day Offer">Chicken Day Offer</option>
                            <option value="No Offer">No Offer</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="noonSalesInput">NOON Sales (AED)</label>
                        <input type="number" class="form-input" id="noonSalesInput" placeholder="0" step="0.01" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="noonOrdersInput">NOON Orders</label>
                        <input type="number" class="form-input" id="noonOrdersInput" placeholder="0" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="deliverySalesInput">Delivery Sales (AED)</label>
                        <input type="number" class="form-input" id="deliverySalesInput" placeholder="0" step="0.01" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="deliveryOrdersInput">Delivery Orders</label>
                        <input type="number" class="form-input" id="deliveryOrdersInput" placeholder="0" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="onlineSalesInput">ONLINE Sales (AED)</label>
                        <input type="number" class="form-input" id="onlineSalesInput" placeholder="0" step="0.01" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="onlineOrdersInput">ONLINE Orders</label>
                        <input type="number" class="form-input" id="onlineOrdersInput" placeholder="0" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="totalOrdersInput">Total Orders</label>
                        <input type="number" class="form-input" id="totalOrdersInput" placeholder="0" required>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn-cancel" id="cancelBtn">Cancel</button>
                    <button type="submit" class="btn-save">Save Data</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <script>
        // Sales data
        let salesData = [
            { 
                week: 'Sep 01/02', 
                offer: 'Ultimate Offer', 
                noon: { sales: 66771.63, orders: 1852 }, 
                delivery: { sales: 39258.9, orders: 837 }, 
                online: { sales: 12337.9, orders: 291 }, 
                total: 118368.43, 
                orders: 2980,
                change: null,
                id: Date.now() + 1
            },
            { 
                week: 'Sep 08/09', 
                offer: 'Ultimate Offer', 
                noon: { sales: 106560.72, orders: 2936 }, 
                delivery: { sales: 28662, orders: 657 }, 
                online: { sales: 9345, orders: 214 }, 
                total: 144567.72, 
                orders: 3807,
                change: 22.10,
                id: Date.now() + 2
            },
            { 
                week: 'Sep 15/16', 
                offer: 'Chicken Day Offer', 
                noon: { sales: 115677, orders: 3847 }, 
                delivery: { sales: 31436, orders: 802 }, 
                online: { sales: 8024, orders: 213 }, 
                total: 155137, 
                orders: 4862,
                change: 7.30,
                id: Date.now() + 3
            },
            { 
                week: 'Sep 22/23', 
                offer: 'Ultimate Offer', 
                noon: { sales: 99297.8, orders: 2919 }, 
                delivery: { sales: 28478, orders: 609 }, 
                online: { sales: 7243, orders: 172 }, 
                total: 135018.8, 
                orders: 3700,
                change: -13.0,
                id: Date.now() + 4
            },
            { 
                week: 'Sep 29/30', 
                offer: 'No Offer', 
                noon: { sales: 36037, orders: 901 }, 
                delivery: { sales: 18673, orders: 401 }, 
                online: { sales: 5382.9, orders: 110 }, 
                total: 60092.9, 
                orders: 1412,
                change: -55.5,
                id: Date.now() + 5
            },
            { 
                week: 'Oct 07/08', 
                offer: 'Ultimate Offer', 
                noon: { sales: 63470, orders: 1788 }, 
                delivery: { sales: 17071.8, orders: 358 }, 
                online: { sales: 3608, orders: 84 }, 
                total: 84149.8, 
                orders: 2230,
                change: null,
                id: Date.now() + 6
            }
        ];

        // Chart variables
        let revenueTrendChart, channelDistributionChart, weeklyChannelPerformanceChart, offerEffectivenessChart;
        
        // Modal variables
        const modal = document.getElementById('dataModal');
        const modalTitle = document.getElementById('modalTitle');
        const dataForm = document.getElementById('dataForm');
        let editingId = null;

        // Notification function
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Toggle data table
        document.getElementById('toggleTable').addEventListener('click', function() {
            const container = document.getElementById('dataTableContainer');
            if (container.style.display === 'none') {
                container.style.display = 'block';
                populateDataTable();
            } else {
                container.style.display = 'none';
            }
        });

        // Populate data table
        function populateDataTable() {
            const tbody = document.getElementById('dataTableBody');
            tbody.innerHTML = '';
            
            salesData.forEach(week => {
                const row = tbody.insertRow();
                row.className = 'editable';
                row.dataset.id = week.id;
                
                // Week
                row.insertCell(0).textContent = week.week;
                
                // Offer Type with badge
                const offerCell = row.insertCell(1);
                offerCell.innerHTML = week.offer + 
                    `<span class="offer-badge ${week.offer === 'Ultimate Offer' ? 'offer-ultimate' : 
                        week.offer === 'Chicken Day Offer' ? 'offer-chicken' : 'offer-none'}">${week.offer}</span>`;
                
                // NOON
                const noonCell = row.insertCell(2);
                noonCell.textContent = `${week.noon.sales.toLocaleString('en-AE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} / ${week.noon.orders}`;
                
                // Delivery
                const deliveryCell = row.insertCell(3);
                deliveryCell.textContent = `${week.delivery.sales.toLocaleString('en-AE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} / ${week.delivery.orders}`;
                
                // ONLINE
                const onlineCell = row.insertCell(4);
                onlineCell.textContent = `${week.online.sales.toLocaleString('en-AE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} / ${week.online.orders}`;
                
                // Total Sales
                const totalCell = row.insertCell(5);
                totalCell.textContent = week.total.toLocaleString('en-AE', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                
                // Total Orders
                row.insertCell(6).textContent = week.orders.toLocaleString();
                
                // Change
                const changeCell = row.insertCell(7);
                if (week.change !== null) {
                    const changeClass = week.change >= 0 ? 'positive-change' : 'negative-change';
                    const changeSymbol = week.change >= 0 ? '+' : '';
                    changeCell.innerHTML = `<span class="${changeClass}">${changeSymbol}${week.change}%</span>`;
                } else {
                    changeCell.textContent = '—';
                }
                
                // Actions
                const actionsCell = row.insertCell(8);
                actionsCell.innerHTML = `
                    <button class="edit-btn" data-id="${week.id}">✏️ Edit</button>
                    <button class="delete-btn" data-id="${week.id}">🗑️ Delete</button>
                `;
            });
            
            // Add event listeners for edit and delete buttons
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.dataset.id);
                    editData(id);
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.dataset.id);
                    deleteData(id);
                });
            });
        }

        // Modal functions
        document.getElementById('addDataBtn').addEventListener('click', function() {
            editingId = null;
            modalTitle.textContent = 'Add New Data';
            dataForm.reset();
            modal.style.display = 'block';
        });

        document.getElementById('clearDataBtn').addEventListener('click', function() {
            if (confirm('Are you sure you want to clear all data? This action cannot be undone.')) {
                salesData = [];
                updateAllCharts();
                updateKPIs();
                showNotification('All data cleared successfully', 'info');
            }
        });

        document.getElementById('exportDataBtn').addEventListener('click', function() {
            const csvContent = "data:text/csv;charset=utf-8," 
                + "Week,Offer Type,NOON Sales,NOON Orders,Delivery Sales,Delivery Orders,ONLINE Sales,ONLINE Orders,Total Sales,Total Orders\n"
                + salesData.map(row => 
                    `${row.week},${row.offer},${row.noon.sales},${row.noon.orders},${row.delivery.sales},${row.delivery.orders},${row.online.sales},${row.online.orders},${row.total},${row.orders}`
                ).join("\n");
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "crispy_chicken_sales_data.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Data exported successfully', 'success');
        });

        document.getElementById('closeModal').addEventListener('click', function() {
            modal.style.display = 'none';
        });

        document.getElementById('cancelBtn').addEventListener('click', function() {
            modal.style.display = 'none';
        });

        window.addEventListener('click', function(event) {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });

        // Form submission
        dataForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const week = document.getElementById('weekInput').value;
            const offer = document.getElementById('offerInput').value;
            const noonSales = parseFloat(document.getElementById('noonSalesInput').value);
            const noonOrders = parseInt(document.getElementById('noonOrdersInput').value);
            const deliverySales = parseFloat(document.getElementById('deliverySalesInput').value);
            const deliveryOrders = parseInt(document.getElementById('deliveryOrdersInput').value);
            const onlineSales = parseFloat(document.getElementById('onlineSalesInput').value);
            const onlineOrders = parseInt(document.getElementById('onlineOrdersInput').value);
            const totalOrders = parseInt(document.getElementById('totalOrdersInput').value);
            const total = noonSales + deliverySales + onlineSales;
            
            if (editingId) {
                // Update existing data
                const index = salesData.findIndex(d => d.id === editingId);
                if (index !== -1) {
                    salesData[index] = {
                        ...salesData[index],
                        week,
                        offer,
                        noon: { sales: noonSales, orders: noonOrders },
                        delivery: { sales: deliverySales, orders: deliveryOrders },
                        online: { sales: onlineSales, orders: onlineOrders },
                        total,
                        orders: totalOrders
                    };
                    showNotification('Data updated successfully', 'success');
                }
            } else {
                // Add new data
                const newData = {
                    week,
                    offer,
                    noon: { sales: noonSales, orders: noonOrders },
                    delivery: { sales: deliverySales, orders: deliveryOrders },
                    online: { sales: onlineSales, orders: onlineOrders },
                    total,
                    orders: totalOrders,
                    change: null,
                    id: Date.now()
                };
                salesData.push(newData);
                showNotification('Data added successfully', 'success');
            }
            
            modal.style.display = 'none';
            dataForm.reset();
            updateAllCharts();
            updateKPIs();
        });

        // Edit data
        function editData(id) {
            const data = salesData.find(d => d.id === id);
            if (data) {
                editingId = id;
                modalTitle.textContent = 'Edit Data';
                document.getElementById('weekInput').value = data.week;
                document.getElementById('offerInput').value = data.offer;
                document.getElementById('noonSalesInput').value = data.noon.sales;
                document.getElementById('noonOrdersInput').value = data.noon.orders;
                document.getElementById('deliverySalesInput').value = data.delivery.sales;
                document.getElementById('deliveryOrdersInput').value = data.delivery.orders;
                document.getElementById('onlineSalesInput').value = data.online.sales;
                document.getElementById('onlineOrdersInput').value = data.online.orders;
                document.getElementById('totalOrdersInput').value = data.orders;
                modal.style.display = 'block';
            }
        }

        // Delete data
        function deleteData(id) {
            if (confirm('Are you sure you want to delete this data?')) {
                salesData = salesData.filter(d => d.id !== id);
                updateAllCharts();
                updateKPIs();
                showNotification('Data deleted successfully', 'info');
            }
        }

        // Update KPIs
        function updateKPIs() {
            const totalSales = salesData.reduce((sum, week) => sum + week.total, 0);
            const totalOrders = salesData.reduce((sum, week) => sum + week.orders, 0);
            const avgWeeklySales = salesData.length > 0 ? totalSales / salesData.length : 0;
            
            document.querySelector('.card:nth-child(1) .kpi').textContent = `AED ${totalSales.toLocaleString('en-AE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.querySelector('.card:nth-child(2) .kpi').textContent = `AED ${avgWeeklySales.toLocaleString('en-AE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.querySelector('.card:nth-child(3) .kpi').textContent = totalOrders.toLocaleString();
            
            // Find best performing week
            if (salesData.length > 0) {
                const bestWeek = salesData.reduce((best, current) => current.total > best.total ? current : best);
                document.querySelector('.card:nth-child(4) .kpi').textContent = bestWeek.week;
                document.querySelector('.card:nth-child(4) .kpi-label').textContent = `${bestWeek.offer}: AED ${bestWeek.total.toLocaleString('en-AE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            }
        }

        // Update all charts
        function updateAllCharts() {
            createRevenueTrendChart();
            createChannelDistributionChart();
            createWeeklyChannelPerformanceChart();
            createOfferEffectivenessChart();
        }

        // Create revenue trend chart
        function createRevenueTrendChart() {
            const ctx = document.getElementById('revenueTrend').getContext('2d');
            
            if (revenueTrendChart) {
                revenueTrendChart.destroy();
            }
            
            revenueTrendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: salesData.map(d => d.week),
                    datasets: [{
                        label: 'Total Sales (AED)',
                        data: salesData.map(d => d.total),
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: function(context) {
                            const index = context.dataIndex;
                            const offer = salesData[index].offer;
                            return offer === 'Chicken Day Offer' ? '#f39c12' : 
                                   offer === 'Ultimate Offer' ? '#3498db' : '#95a5a6';
                        },
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Sales: AED ${context.raw.toLocaleString('en-AE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return 'AED ' + value.toLocaleString('en-AE');
                                }
                            }
                        }
                    }
                }
            });
        }

        // Create channel distribution chart
        function createChannelDistributionChart() {
            const ctx = document.getElementById('channelDistribution').getContext('2d');
            
            if (channelDistributionChart) {
                channelDistributionChart.destroy();
            }
            
            // Calculate total for each channel
            const noonTotal = salesData.reduce((sum, week) => sum + week.noon.sales, 0);
            const deliveryTotal = salesData.reduce((sum, week) => sum + week.delivery.sales, 0);
            const onlineTotal = salesData.reduce((sum, week) => sum + week.online.sales, 0);
            
            channelDistributionChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['NOON', 'Delivery', 'ONLINE'],
                    datasets: [{
                        data: [noonTotal, deliveryTotal, onlineTotal],
                        backgroundColor: ['#3498db', '#f39c12', '#2ecc71'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: {
                                    size: 14
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const percentage = ((value / (noonTotal + deliveryTotal + onlineTotal)) * 100).toFixed(1);
                                    return `${label}: AED ${value.toLocaleString('en-AE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Create weekly channel performance chart
        function createWeeklyChannelPerformanceChart() {
            const ctx = document.getElementById('weeklyChannelPerformance').getContext('2d');
            
            if (weeklyChannelPerformanceChart) {
                weeklyChannelPerformanceChart.destroy();
            }
            
            weeklyChannelPerformanceChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: salesData.map(d => d.week),
                    datasets: [
                        {
                            label: 'NOON',
                            data: salesData.map(d => d.noon.sales),
                            backgroundColor: '#3498db',
                            stack: 'Stack 0'
                        },
                        {
                            label: 'Delivery',
                            data: salesData.map(d => d.delivery.sales),
                            backgroundColor: '#f39c12',
                            stack: 'Stack 0'
                        },
                        {
                            label: 'ONLINE',
                            data: salesData.map(d => d.online.sales),
                            backgroundColor: '#2ecc71',
                            stack: 'Stack 0'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: AED ${context.raw.toLocaleString('en-AE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                        },
                        y: {
                            stacked: true,
                            ticks: {
                                callback: function(value) {
                                    return 'AED ' + value.toLocaleString('en-AE');
                                }
                            }
                        }
                    }
                }
            });
        }

        // Create offer effectiveness chart
        function createOfferEffectivenessChart() {
            const ctx = document.getElementById('offerEffectiveness').getContext('2d');
            
            if (offerEffectivenessChart) {
                offerEffectivenessChart.destroy();
            }
            
            // Calculate average sales by offer type
            const offerPerformance = {};
            salesData.forEach(week => {
                if (!offerPerformance[week.offer]) {
                    offerPerformance[week.offer] = { total: 0, count: 0 };
                }
                offerPerformance[week.offer].total += week.total;
                offerPerformance[week.offer].count++;
            });
            
            const labels = Object.keys(offerPerformance);
            const data = labels.map(offer => Math.round(offerPerformance[offer].total / offerPerformance[offer].count));
            
            offerEffectivenessChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Average Sales (AED)',
                        data: data,
                        backgroundColor: [
                            '#3498db',
                            '#f39c12',
                            '#95a5a6'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Average Sales: AED ${context.raw.toLocaleString('en-AE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return 'AED ' + value.toLocaleString('en-AE');
                                }
                            }
                        }
                    }
                }
            });
        }

        // Initialize charts on load
        window.addEventListener('load', function() {
            updateAllCharts();
            updateKPIs();
        });
    </script>
</body>
</html>
