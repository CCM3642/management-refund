<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate="title">نظام إدارة تذاكر التعويض - Crispy Chicken</title>
    
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Custom CSS -->
    <style>
        :root {
            --primary-color: #FF6B35;
            --secondary-color: #F7931E;
            --dark-color: #333;
            --light-color: #f8f9fa;
            --glass-bg: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(255, 255, 255, 0.3);
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            overflow-x: hidden;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 1.8rem;
            margin: 0;
        }
        
        /* Language Switcher */
        .lang-switcher {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 0.3rem 0.8rem;
            color: white;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .lang-switcher:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* Sidebar */
        .sidebar {
            background: white;
            height: calc(100vh - 70px);
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
            padding: 1.5rem 0;
        }
        
        .sidebar .nav-link {
            color: var(--dark-color);
            padding: 0.8rem 1.5rem;
            border-radius: 0;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .sidebar .nav-link:hover {
            background-color: rgba(255, 107, 53, 0.1);
            color: var(--primary-color);
        }
        
        .sidebar .nav-link.active {
            background-color: rgba(255, 107, 53, 0.1);
            color: var(--primary-color);
            border-right: 3px solid var(--primary-color);
        }
        
        /* Main Content */
        .main-content {
            padding: 2rem;
            min-height: calc(100vh - 70px);
        }
        
        /* Glassmorphism Dock */
        .smart-dock {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 10px 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 1px solid var(--glass-border);
            z-index: 1000;
            display: none;
        }
        
        .dock-section {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .dock-section:last-child {
            margin-bottom: 0;
        }
        
        .dock-item {
            background: white;
            border: none;
            border-radius: 10px;
            padding: 8px 15px;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--dark-color);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .dock-item:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        /* Notifications */
        .notification-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1050;
            max-width: 350px;
        }
        
        .notification {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .notification-icon {
            font-size: 1.5rem;
            margin-left: 10px;
        }
        
        .notification-message {
            flex: 1;
            margin-right: 10px;
        }
        
        .notification-close {
            cursor: pointer;
            font-size: 1.2rem;
            color: #999;
        }
        
        /* Cards */
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            background: white;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            border-radius: 15px 15px 0 0 !important;
            padding: 1.2rem 1.5rem;
        }
        
        /* KPI Cards */
        .kpi-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            height: 100%;
        }
        
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .kpi-change {
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .positive {
            color: #28a745;
        }
        
        .negative {
            color: #dc3545;
        }
        
        /* Case Cards */
        .case-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        
        .case-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .case-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-new {
            background: rgba(255, 193, 7, 0.2);
            color: #856404;
        }
        
        .status-open {
            background: rgba(0, 123, 255, 0.2);
            color: #0056b3;
        }
        
        .status-sent {
            background: rgba(0, 123, 255, 0.2);
            color: #0056b3;
        }
        
        .status-closed {
            background: rgba(40, 167, 69, 0.2);
            color: #155724;
        }
        
        .status-rejected {
            background: rgba(220, 53, 69, 0.2);
            color: #721c24;
        }
        
        /* Buttons */
        .btn-primary {
            background: var(--primary-color);
            border: none;
            border-radius: 10px;
            padding: 0.6rem 1.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: #e55a2b;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.3);
        }
        
        .btn-secondary {
            background: #6c757d;
            border: none;
            border-radius: 10px;
            padding: 0.6rem 1.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 117, 125, 0.3);
        }
        
        .btn-danger {
            background: #dc3545;
            border: none;
            border-radius: 10px;
            padding: 0.6rem 1.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }
        
        .btn-success {
            background: #28a745;
            border: none;
            border-radius: 10px;
            padding: 0.6rem 1.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }
        
        /* Form Controls */
        .form-control, .form-select {
            border-radius: 10px;
            border: 1px solid #ddd;
            padding: 0.75rem 1rem;
            transition: all 0.3s ease;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(255, 107, 53, 0.25);
        }
        
        /* Charts Container */
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            height: 400px;
        }
        
        /* Loading Spinner */
        .spinner-border {
            width: 1.5rem;
            height: 1.5rem;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .sidebar {
                height: auto;
                position: fixed;
                top: 70px;
                left: 0;
                width: 100%;
                z-index: 1000;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar.show {
                transform: translateX(0);
            }
            
            .main-content {
                padding: 1rem;
            }
            
            .notification-container {
                right: 10px;
                max-width: calc(100% - 20px);
            }
        }
        
        /* Platform Tabs */
        .platform-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .platform-tab {
            padding: 10px 20px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .platform-tab.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        /* Summary Cards */
        .summary-card {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .summary-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            transform: rotate(45deg);
        }
        
        .summary-card-content {
            position: relative;
            z-index: 1;
        }
        
        /* Branch Analysis */
        .branch-analysis {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .branch-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .branch-stats {
            display: flex;
            gap: 15px;
            margin-bottom: 1rem;
        }
        
        .branch-stat {
            text-align: center;
            flex: 1;
        }
        
        .branch-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .branch-stat-label {
            font-size: 0.9rem;
            color: #666;
        }
        
        /* WhatsApp Button */
        .whatsapp-btn {
            background: #25d366;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 0.5rem 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .whatsapp-btn:hover {
            background: #128c7e;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(37, 211, 102, 0.3);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container-fluid d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center">
                <i class="bi bi-egg-fried fs-2 me-3"></i>
                <h1 data-translate="header.title">نظام إدارة تذاكر التعويض</h1>
            </div>
            <div class="d-flex align-items-center">
                <span class="me-3" data-translate="header.brand">Crispy Chicken</span>
                <button class="lang-switcher me-3" id="langSwitcher">EN</button>
                <button class="btn btn-light btn-sm" id="toggleSidebar">
                    <i class="bi bi-list"></i>
                </button>
            </div>
        </div>
    </header>
    
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-2 col-lg-2 sidebar" id="sidebar">
                <nav class="nav flex-column">
                    <a class="nav-link active" href="#" data-page="dashboard">
                        <i class="bi bi-speedometer2 me-2"></i>
                        <span data-translate="sidebar.dashboard">لوحة التحكم</span>
                    </a>
                    <a class="nav-link" href="#" data-page="cases">
                        <i class="bi bi-ticket-perforated me-2"></i>
                        <span data-translate="sidebar.cases">إدارة الحالات</span>
                    </a>
                    <a class="nav-link" href="#" data-page="platform-analysis">
                        <i class="bi bi-graph-up me-2"></i>
                        <span data-translate="sidebar.platform">تحليل المنصات</span>
                    </a>
                    <a class="nav-link" href="#" data-page="branch-analysis">
                        <i class="bi bi-building me-2"></i>
                        <span data-translate="sidebar.branch">تحليل المطاعم</span>
                    </a>
                    <a class="nav-link" href="#" data-page="summaries">
                        <i class="bi bi-calendar3 me-2"></i>
                        <span data-translate="sidebar.summaries">الملخصات</span>
                    </a>
                    <a class="nav-link" href="#" data-page="settings">
                        <i class="bi bi-gear me-2"></i>
                        <span data-translate="sidebar.settings">الإعدادات</span>
                    </a>
                </nav>
            </div>
            
            <!-- Main Content -->
            <div class="col-md-10 col-lg-10 main-content">
                <!-- Dashboard Page -->
                <div id="dashboard-page" class="page-content">
                    <h2 class="mb-4" data-translate="dashboard.title">لوحة التحكم</h2>
                    
                    <!-- KPI Cards -->
                    <div class="row mb-4">
                        <div class="col-md-3 col-sm-6 mb-3">
                            <div class="kpi-card">
                                <h3 data-translate="dashboard.totalCases">إجمالي الحالات</h3>
                                <div class="kpi-value">142</div>
                                <div class="kpi-change positive">+12%</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-3">
                            <div class="kpi-card">
                                <h3 data-translate="dashboard.totalCompensation">إجمالي التعويضات</h3>
                                <div class="kpi-value">24,560 AED</div>
                                <div class="kpi-change positive">+8%</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-3">
                            <div class="kpi-card">
                                <h3 data-translate="dashboard.rejectionRate">معدل الرفض</h3>
                                <div class="kpi-value">32%</div>
                                <div class="kpi-change negative">+5%</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-3">
                            <div class="kpi-card">
                                <h3 data-translate="dashboard.recovered">المبالغ المستردة</h3>
                                <div class="kpi-value">8,240 AED</div>
                                <div class="kpi-change positive">+15%</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Charts -->
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="chart-container">
                                <h4 class="mb-3" data-translate="dashboard.categoryChart">توزيع الحالات حسب الفئة</h4>
                                <canvas id="categoryChart"></canvas>
                            </div>
                        </div>
                        <div class="col-md-6 mb-4">
                            <div class="chart-container">
                                <h4 class="mb-3" data-translate="dashboard.branchChart">توزيع الحالات حسب الفرع</h4>
                                <canvas id="branchChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-12 mb-4">
                            <div class="chart-container">
                                <h4 class="mb-3" data-translate="dashboard.trendChart">الاتجاه الشهري</h4>
                                <canvas id="trendChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Cases Page -->
                <div id="cases-page" class="page-content" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 data-translate="cases.title">إدارة الحالات</h2>
                        <button class="btn btn-primary" id="addCaseBtn">
                            <i class="bi bi-plus-circle me-2"></i>
                            <span data-translate="cases.addNew">إضافة حالة جديدة</span>
                        </button>
                    </div>
                    
                    <!-- Filters -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3 mb-3">
                                    <input type="text" class="form-control" id="searchInput" placeholder="بحث..." data-translate-placeholder="cases.search">
                                </div>
                                <div class="col-md-3 mb-3">
                                    <select class="form-select" id="branchFilter">
                                        <option value="" data-translate="cases.allBranches">جميع الفروع</option>
                                        <option value="Khalidiya">Khalidiya</option>
                                        <option value="Muroor">Muroor</option>
                                        <option value="Shabiya 11">Shabiya 11</option>
                                        <option value="Al Barsha">Al Barsha</option>
                                        <option value="Al Satwa">Al Satwa</option>
                                        <option value="Electra">Electra</option>
                                        <option value="Hamdan">Hamdan</option>
                                    </select>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <select class="form-select" id="statusFilter">
                                        <option value="" data-translate="cases.allStatuses">جميع الحالات</option>
                                        <option value="new" data-translate="cases.statusNew">جديدة</option>
                                        <option value="open" data-translate="cases.statusOpen">مفتوحة</option>
                                        <option value="sent" data-translate="cases.statusSent">تم الإرسال</option>
                                        <option value="closed" data-translate="cases.statusClosed">مغلقة</option>
                                        <option value="rejected" data-translate="cases.statusRejected">مرفوضة</option>
                                    </select>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <select class="form-select" id="categoryFilter">
                                        <option value="" data-translate="cases.allCategories">جميع الفئات</option>
                                        <option value="Cold Food" data-translate="cases.coldFood">طعام بارد</option>
                                        <option value="Late Delivery" data-translate="cases.lateDelivery">تأخير في التوصيل</option>
                                        <option value="Missing/Incorrect" data-translate="cases.missingIncorrect">طلب خاطئ/مفقود</option>
                                        <option value="Other" data-translate="cases.other">أخرى</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Cases List -->
                    <div id="casesList">
                        <!-- Case Card Example -->
                        <div class="case-card">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <h5 class="mb-1" data-translate="cases.case1Title">طلب #12345 - طعام بارد</h5>
                                    <p class="text-muted" data-translate="cases.case1Branch">الفرع: Khalidiya | المنصة: Noon</p>
                                </div>
                                <span class="case-status status-new" data-translate="cases.statusNew">جديدة</span>
                            </div>
                            <div class="mb-3">
                                <p data-translate="cases.case1Desc">الطعام وصل بارداً بعد 45 دقيقة من الطلب</p>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <span class="badge bg-primary me-2">50 AED</span>
                                    <span class="badge bg-info me-2">2023-10-15</span>
                                </div>
                                <div>
                                    <button class="btn btn-sm btn-primary me-2" data-translate="cases.edit">تعديل</button>
                                    <button class="btn btn-sm btn-danger" data-translate="cases.delete">حذف</button>
                                    <button class="btn btn-sm btn-success whatsapp-btn" data-case-id="12345">
                                        <i class="bi bi-whatsapp"></i> <span data-translate="cases.whatsapp">واتساب</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="case-card">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <h5 class="mb-1" data-translate="cases.case2Title">طلب #12346 - طلب خاطئ</h5>
                                    <p class="text-muted" data-translate="cases.case2Branch">الفرع: Al Barsha | المنصة: Careem</p>
                                </div>
                                <span class="case-status status-open" data-translate="cases.statusOpen">مفتوحة</span>
                            </div>
                            <div class="mb-3">
                                <p data-translate="cases.case2Desc">تم طلب وجبة دجاج مقلي لكن وصلت دجاج مشوي</p>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <span class="badge bg-primary me-2">30 AED</span>
                                    <span class="badge bg-info me-2">2023-10-14</span>
                                </div>
                                <div>
                                    <button class="btn btn-sm btn-primary me-2" data-translate="cases.edit">تعديل</button>
                                    <button class="btn btn-sm btn-danger" data-translate="cases.delete">حذف</button>
                                    <button class="btn btn-sm btn-success whatsapp-btn" data-case-id="12346">
                                        <i class="bi bi-whatsapp"></i> <span data-translate="cases.whatsapp">واتساب</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="case-card">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <h5 class="mb-1" data-translate="cases.case3Title">طلب #12347 - تأخير في التوصيل</h5>
                                    <p class="text-muted" data-translate="cases.case3Branch">الفرع: Muroor | المنصة: Noon</p>
                                </div>
                                <span class="case-status status-closed" data-translate="cases.statusClosed">مغلقة</span>
                            </div>
                            <div class="mb-3">
                                <p data-translate="cases.case3Desc">التوصيل تأخر 30 دقيقة عن الوقت المحدد</p>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <span class="badge bg-primary me-2">20 AED</span>
                                    <span class="badge bg-info me-2">2023-10-13</span>
                                    <span class="badge bg-success me-2" data-translate="cases.recovered">10 AED مسترد</span>
                                </div>
                                <div>
                                    <button class="btn btn-sm btn-primary me-2" data-translate="cases.edit">تعديل</button>
                                    <button class="btn btn-sm btn-danger" data-translate="cases.delete">حذف</button>
                                    <button class="btn btn-sm btn-success whatsapp-btn" data-case-id="12347">
                                        <i class="bi bi-whatsapp"></i> <span data-translate="cases.whatsapp">واتساب</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Platform Analysis Page -->
                <div id="platform-analysis-page" class="page-content" style="display: none;">
                    <h2 class="mb-4" data-translate="platform.title">تحليل المنصات</h2>
                    
                    <!-- Platform Tabs -->
                    <div class="platform-tabs">
                        <div class="platform-tab active" data-platform="all" data-translate="platform.allPlatforms">جميع المنصات</div>
                        <div class="platform-tab" data-platform="Noon" data-translate="platform.noon">منصة Noon</div>
                        <div class="platform-tab" data-platform="Careem" data-translate="platform.careem">منصة Careem</div>
                    </div>
                    
                    <!-- KPI Cards -->
                    <div class="row mb-4">
                        <div class="col-md-4 mb-3">
                            <div class="kpi-card">
                                <h3 data-translate="platform.totalCases">إجمالي الحالات</h3>
                                <div class="kpi-value" id="platform-total-cases">142</div>
                                <div class="kpi-change positive" id="platform-case-change">+12%</div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="kpi-card">
                                <h3 data-translate="platform.totalCompensation">إجمالي التعويضات</h3>
                                <div class="kpi-value" id="platform-total-compensation">24,560 AED</div>
                                <div class="kpi-change positive" id="platform-compensation-change">+8%</div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="kpi-card">
                                <h3 data-translate="platform.rejectionRate">معدل الرفض</h3>
                                <div class="kpi-value" id="platform-rejection-rate">32%</div>
                                <div class="kpi-change negative" id="platform-rejection-change">+5%</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Charts -->
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="chart-container">
                                <h4 class="mb-3" data-translate="platform.categoryChart">توزيع الحالات حسب الفئة</h4>
                                <canvas id="platform-categoryChart"></canvas>
                            </div>
                        </div>
                        <div class="col-md-6 mb-4">
                            <div class="chart-container">
                                <h4 class="mb-3" data-translate="platform.branchChart">توزيع الحالات حسب المطعم</h4>
                                <canvas id="platform-branchChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-12 mb-4">
                            <div class="chart-container">
                                <h4 class="mb-3" data-translate="platform.trendChart">الاتجاه الشهري</h4>
                                <canvas id="platform-trendChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Branch Analysis Page -->
                <div id="branch-analysis-page" class="page-content" style="display: none;">
                    <h2 class="mb-4" data-translate="branch.title">تحليل المطاعم</h2>
                    
                    <div id="branchAnalysisList">
                        <!-- Branch Analysis Cards will be dynamically generated here -->
                    </div>
                </div>
                
                <!-- Summaries Page -->
                <div id="summaries-page" class="page-content" style="display: none;">
                    <h2 class="mb-4" data-translate="summaries.title">الملخصات</h2>
                    
                    <!-- Summary Type Tabs -->
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="summary-card">
                                <div class="summary-card-content">
                                    <h3 data-translate="summaries.daily">ملخص يومي</h3>
                                    <p class="mb-0" data-translate="summaries.dailyUpdated">آخر تحديث: اليوم</p>
                                    <div class="mt-3">
                                        <div class="d-flex justify-content-between mb-2">
                                            <span data-translate="summaries.totalCases">إجمالي الحالات</span>
                                            <span class="fw-bold">15</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span data-translate="summaries.totalCompensation">إجمالي التعويضات</span>
                                            <span class="fw-bold">2,450 AED</span>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <span data-translate="summaries.rejectionRate">معدل الرفض</span>
                                            <span class="fw-bold">25%</span>
                                        </div>
                                    </div>
                                    <button class="btn btn-light mt-3" data-translate="summaries.viewDetails">عرض التفاصيل</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="summary-card">
                                <div class="summary-card-content">
                                    <h3 data-translate="summaries.weekly">ملخص أسبوعي</h3>
                                    <p class="mb-0" data-translate="summaries.weeklyUpdated">آخر تحديث: الأسبوع الماضي</p>
                                    <div class="mt-3">
                                        <div class="d-flex justify-content-between mb-2">
                                            <span data-translate="summaries.totalCases">إجمالي الحالات</span>
                                            <span class="fw-bold">98</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span data-translate="summaries.totalCompensation">إجمالي التعويضات</span>
                                            <span class="fw-bold">16,320 AED</span>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <span data-translate="summaries.rejectionRate">معدل الرفض</span>
                                            <span class="fw-bold">30%</span>
                                        </div>
                                    </div>
                                    <button class="btn btn-light mt-3" data-translate="summaries.viewDetails">عرض التفاصيل</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="summary-card">
                                <div class="summary-card-content">
                                    <h3 data-translate="summaries.monthly">ملخص شهري</h3>
                                    <p class="mb-0" data-translate="summaries.monthlyUpdated">آخر تحديث: الشهر الماضي</p>
                                    <div class="mt-3">
                                        <div class="d-flex justify-content-between mb-2">
                                            <span data-translate="summaries.totalCases">إجمالي الحالات</span>
                                            <span class="fw-bold">425</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span data-translate="summaries.totalCompensation">إجمالي التعويضات</span>
                                            <span class="fw-bold">72,450 AED</span>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <span data-translate="summaries.rejectionRate">معدل الرفض</span>
                                            <span class="fw-bold">28%</span>
                                        </div>
                                    </div>
                                    <button class="btn btn-light mt-3" data-translate="summaries.viewDetails">عرض التفاصيل</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Detailed Charts -->
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="chart-container">
                                <h4 class="mb-3" data-translate="summaries.dailyTrend">اتجاهات الحالات اليومية</h4>
                                <canvas id="dailyTrendChart"></canvas>
                            </div>
                        </div>
                        <div class="col-md-6 mb-4">
                            <div class="chart-container">
                                <h4 class="mb-3" data-translate="summaries.weeklyTrend">اتجاهات الحالات الأسبوعية</h4>
                                <canvas id="weeklyTrendChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-12 mb-4">
                            <div class="chart-container">
                                <h4 class="mb-3" data-translate="summaries.monthlyTrend">اتجاهات الحالات الشهرية</h4>
                                <canvas id="monthlyTrendChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Send Summary Buttons -->
                    <div class="row mt-4">
                        <div class="col-md-4 text-center">
                            <button class="btn btn-primary w-100" id="sendDailySummary">
                                <i class="bi bi-send me-2"></i>
                                <span data-translate="summaries.sendDaily">إرسال ملخص يومي</span>
                            </button>
                        </div>
                        <div class="col-md-4 text-center">
                            <button class="btn btn-primary w-100" id="sendWeeklySummary">
                                <i class="bi bi-send me-2"></i>
                                <span data-translate="summaries.sendWeekly">إرسال ملخص أسبوعي</span>
                            </button>
                        </div>
                        <div class="col-md-4 text-center">
                            <button class="btn btn-primary w-100" id="sendMonthlySummary">
                                <i class="bi bi-send me-2"></i>
                                <span data-translate="summaries.sendMonthly">إرسال ملخص شهري</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Settings Page -->
                <div id="settings-page" class="page-content" style="display: none;">
                    <h2 class="mb-4" data-translate="settings.title">الإعدادات</h2>
                    
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0" data-translate="settings.branchManagement">إدارة الفروع</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th data-translate="settings.branch">الفرع</th>
                                                    <th data-translate="settings.whatsapp">WhatsApp</th>
                                                    <th data-translate="settings.status">الحالة</th>
                                                    <th data-translate="settings.actions">الإجراءات</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>Crispy Chicken Khalidiya</td>
                                                    <td>+971 56 949 4764</td>
                                                    <td><span class="badge bg-success" data-translate="settings.active">نشط</span></td>
                                                    <td>
                                                        <button class="btn btn-sm btn-primary" data-translate="settings.edit">تعديل</button>
                                                        <button class="btn btn-sm btn-danger" data-translate="settings.delete">حذف</button>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>Crispy Chicken Muroor</td>
                                                    <td>+971 50 541 4641</td>
                                                    <td><span class="badge bg-success" data-translate="settings.active">نشط</span></td>
                                                    <td>
                                                        <button class="btn btn-sm btn-primary" data-translate="settings.edit">تعديل</button>
                                                        <button class="btn btn-sm btn-danger" data-translate="settings.delete">حذف</button>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>Crispy Chicken Shabiya 11</td>
                                                    <td>+971 56 269 0688</td>
                                                    <td><span class="badge bg-success" data-translate="settings.active">نشط</span></td>
                                                    <td>
                                                        <button class="btn btn-sm btn-primary" data-translate="settings.edit">تعديل</button>
                                                        <button class="btn btn-sm btn-danger" data-translate="settings.delete">حذف</button>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>Crispy Chicken Al Barsha</td>
                                                    <td>+971 56 965 9524</td>
                                                    <td><span class="badge bg-success" data-translate="settings.active">نشط</span></td>
                                                    <td>
                                                        <button class="btn btn-sm btn-primary" data-translate="settings.edit">تعديل</button>
                                                        <button class="btn btn-sm btn-danger" data-translate="settings.delete">حذف</button>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>Crispy Chicken Al Satwa</td>
                                                    <td>+971 56 797 0685</td>
                                                    <td><span class="badge bg-success" data-translate="settings.active">نشط</span></td>
                                                    <td>
                                                        <button class="btn btn-sm btn-primary" data-translate="settings.edit">تعديل</button>
                                                        <button class="btn btn-sm btn-danger" data-translate="settings.delete">حذف</button>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>Crispy Chicken Electra</td>
                                                    <td>+971 56 386 6859</td>
                                                    <td><span class="badge bg-success" data-translate="settings.active">نشط</span></td>
                                                    <td>
                                                        <button class="btn btn-sm btn-primary" data-translate="settings.edit">تعديل</button>
                                                        <button class="btn btn-sm btn-danger" data-translate="settings.delete">حذف</button>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>Crispy Chicken Hamdan</td>
                                                    <td>+971 55 688 6650</td>
                                                    <td><span class="badge bg-success" data-translate="settings.active">نشط</span></td>
                                                    <td>
                                                        <button class="btn btn-sm btn-primary" data-translate="settings.edit">تعديل</button>
                                                        <button class="btn btn-sm btn-danger" data-translate="settings.delete">حذف</button>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <button class="btn btn-primary mt-3">
                                        <i class="bi bi-plus-circle me-2"></i>
                                        <span data-translate="settings.addBranch">إضافة فرع جديد</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0" data-translate="settings.storageManagement">إدارة التخزين</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-4">
                                        <div class="d-flex justify-content-between mb-2">
                                            <span data-translate="settings.storageUsed">مساحة التخزين المستخدمة</span>
                                            <span>1.2 GB / 5 GB</span>
                                        </div>
                                        <div class="progress" style="height: 20px;">
                                            <div class="progress-bar bg-warning" role="progressbar" style="width: 24%">24%</div>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <h6 data-translate="settings.autoCleanup">خيارات التنظيف التلقائي</h6>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="autoDeleteOldImages" checked>
                                            <label class="form-check-label" for="autoDeleteOldImages" data-translate="settings.deleteOldImages">حذف الصور القديمة</label>
                                        </div>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="autoDeleteOldCases" checked>
                                            <label class="form-check-label" for="autoDeleteOldCases" data-translate="settings.deleteOldCases">إزالة الحالات الأقدم من 3 أشهر</label>
                                        </div>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="autoBackup">
                                            <label class="form-check-label" for="autoBackup" data-translate="settings.autoBackup">النسخ الاحتياطي التلقائي</label>
                                        </div>
                                    </div>
                                    
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-secondary" data-translate="settings.cleanupStorage">تنظيف التخزين</button>
                                        <button class="btn btn-primary" data-translate="settings.resetData">إعادة تعيين البيانات</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Smart Dock -->
    <div class="smart-dock" id="smartDock">
        <div class="dock-section quick-actions">
            <button class="dock-item" data-action="add-case" data-translate="dock.addCase">إضافة حالة</button>
            <button class="dock-item" data-action="samples" data-translate="dock.samples">عينات</button>
        </div>
        <div class="dock-section reports">
            <button class="dock-item" data-action="print-reports" data-translate="dock.printReports">طباعة التقارير</button>
        </div>
        <div class="dock-section export">
            <button class="dock-item" data-action="export-excel" data-translate="dock.excel">Excel</button>
            <button class="dock-item" data-action="export-pdf" data-translate="dock.pdf">PDF</button>
        </div>
        <div class="dock-section management">
            <button class="dock-item" data-action="reset" data-translate="dock.reset">إعادة تعيين</button>
        </div>
        <div class="dock-section tools">
            <button class="dock-item" data-action="heatmap" data-translate="dock.heatmap">خريطة الحرارة</button>
            <button class="dock-item" data-action="storage" data-translate="dock.storage">التخزين</button>
        </div>
    </div>
    
    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>
    
    <!-- Add Case Modal -->
    <div class="modal fade" id="addCaseModal" tabindex="-1" aria-labelledby="addCaseModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addCaseModalLabel" data-translate="modal.addCaseTitle">إضافة حالة جديدة</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addCaseForm">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="orderId" class="form-label" data-translate="modal.orderId">رقم الطلب</label>
                                <input type="text" class="form-control" id="orderId" required>
                            </div>
                            <div class="col-md-6">
                                <label for="orderDate" class="form-label" data-translate="modal.orderDate">تاريخ الطلب</label>
                                <input type="date" class="form-control" id="orderDate" required>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="branch" class="form-label" data-translate="modal.branch">الفرع</label>
                                <select class="form-select" id="branch" required>
                                    <option value="" data-translate="modal.selectBranch">اختر الفرع</option>
                                    <option value="Khalidiya">Khalidiya</option>
                                    <option value="Muroor">Muroor</option>
                                    <option value="Shabiya 11">Shabiya 11</option>
                                    <option value="Al Barsha">Al Barsha</option>
                                    <option value="Al Satwa">Al Satwa</option>
                                    <option value="Electra">Electra</option>
                                    <option value="Hamdan">Hamdan</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="platform" class="form-label" data-translate="modal.platform">المنصة</label>
                                <select class="form-select" id="platform" required>
                                    <option value="" data-translate="modal.selectPlatform">اختر المنصة</option>
                                    <option value="Noon">Noon</option>
                                    <option value="Careem">Careem</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="problemType" class="form-label" data-translate="modal.problemType">نوع المشكلة</label>
                            <select class="form-select" id="problemType" required>
                                <option value="" data-translate="modal.selectProblem">اختر نوع المشكلة</option>
                                <option value="Cold Food" data-translate="modal.coldFood">طعام بارد</option>
                                <option value="Late Delivery" data-translate="modal.lateDelivery">تأخير في التوصيل</option>
                                <option value="Missing/Incorrect" data-translate="modal.missingIncorrect">طلب خاطئ/مفقود</option>
                                <option value="Other" data-translate="modal.other">أخرى</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="description" class="form-label" data-translate="modal.description">وصف المشكلة</label>
                            <textarea class="form-control" id="description" rows="3" required></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label for="evidence" class="form-label" data-translate="modal.evidence">الأدلة (صور، روابط)</label>
                            <input type="text" class="form-control" id="evidence" placeholder="أدخل رابط الصورة أو الوصف" data-translate-placeholder="modal.evidencePlaceholder">
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="compensation" class="form-label" data-translate="modal.compensation">قيمة التعويض (AED)</label>
                                <input type="number" class="form-control" id="compensation" required>
                            </div>
                            <div class="col-md-6">
                                <label for="recovered" class="form-label" data-translate="modal.recovered">المبلغ المسترد (AED)</label>
                                <input type="number" class="form-control" id="recovered" value="0">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-translate="modal.cancel">إلغاء</button>
                    <button type="button" class="btn btn-primary" id="saveCaseBtn" data-translate="modal.save">حفظ الحالة</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script>
        // Translation System
        const translations = {
            ar: {
                title: "نظام إدارة تذاكر التعويض - Crispy Chicken",
                header: {
                    title: "نظام إدارة تذاكر التعويض",
                    brand: "Crispy Chicken"
                },
                sidebar: {
                    dashboard: "لوحة التحكم",
                    cases: "إدارة الحالات",
                    platform: "تحليل المنصات",
                    branch: "تحليل المطاعم",
                    summaries: "الملخصات",
                    settings: "الإعدادات"
                },
                dashboard: {
                    title: "لوحة التحكم",
                    totalCases: "إجمالي الحالات",
                    totalCompensation: "إجمالي التعويضات",
                    rejectionRate: "معدل الرفض",
                    recovered: "المبالغ المستردة",
                    categoryChart: "توزيع الحالات حسب الفئة",
                    branchChart: "توزيع الحالات حسب الفرع",
                    trendChart: "الاتجاه الشهري"
                },
                cases: {
                    title: "إدارة الحالات",
                    addNew: "إضافة حالة جديدة",
                    search: "بحث...",
                    allBranches: "جميع الفروع",
                    allStatuses: "جميع الحالات",
                    allCategories: "جميع الفئات",
                    statusNew: "جديدة",
                    statusOpen: "مفتوحة",
                    statusSent: "تم الإرسال",
                    statusClosed: "مغلقة",
                    statusRejected: "مرفوضة",
                    coldFood: "طعام بارد",
                    lateDelivery: "تأخير في التوصيل",
                    missingIncorrect: "طلب خاطئ/مفقود",
                    other: "أخرى",
                    case1Title: "طلب #12345 - طعام بارد",
                    case1Branch: "الفرع: Khalidiya | المنصة: Noon",
                    case1Desc: "الطعام وصل بارداً بعد 45 دقيقة من الطلب",
                    case2Title: "طلب #12346 - طلب خاطئ",
                    case2Branch: "الفرع: Al Barsha | المنصة: Careem",
                    case2Desc: "تم طلب وجبة دجاج مقلي لكن وصلت دجاج مشوي",
                    case3Title: "طلب #12347 - تأخير في التوصيل",
                    case3Branch: "الفرع: Muroor | المنصة: Noon",
                    case3Desc: "التوصيل تأخر 30 دقيقة عن الوقت المحدد",
                    recovered: "10 AED مسترد",
                    edit: "تعديل",
                    delete: "حذف",
                    whatsapp: "واتساب"
                },
                platform: {
                    title: "تحليل المنصات",
                    allPlatforms: "جميع المنصات",
                    noon: "منصة Noon",
                    careem: "منصة Careem",
                    totalCases: "إجمالي الحالات",
                    totalCompensation: "إجمالي التعويضات",
                    rejectionRate: "معدل الرفض",
                    categoryChart: "توزيع الحالات حسب الفئة",
                    branchChart: "توزيع الحالات حسب المطعم",
                    trendChart: "الاتجاه الشهري"
                },
                branch: {
                    title: "تحليل المطاعم"
                },
                summaries: {
                    title: "الملخصات",
                    daily: "ملخص يومي",
                    dailyUpdated: "آخر تحديث: اليوم",
                    weekly: "ملخص أسبوعي",
                    weeklyUpdated: "آخر تحديث: الأسبوع الماضي",
                    monthly: "ملخص شهري",
                    monthlyUpdated: "آخر تحديث: الشهر الماضي",
                    totalCases: "إجمالي الحالات",
                    totalCompensation: "إجمالي التعويضات",
                    rejectionRate: "معدل الرفض",
                    viewDetails: "عرض التفاصيل",
                    dailyTrend: "اتجاهات الحالات اليومية",
                    weeklyTrend: "اتجاهات الحالات الأسبوعية",
                    monthlyTrend: "اتجاهات الحالات الشهرية",
                    sendDaily: "إرسال ملخص يومي",
                    sendWeekly: "إرسال ملخص أسبوعي",
                    sendMonthly: "إرسال ملخص شهري"
                },
                settings: {
                    title: "الإعدادات",
                    branchManagement: "إدارة الفروع",
                    branch: "الفرع",
                    whatsapp: "WhatsApp",
                    status: "الحالة",
                    actions: "الإجراءات",
                    active: "نشط",
                    edit: "تعديل",
                    delete: "حذف",
                    addBranch: "إضافة فرع جديد",
                    storageManagement: "إدارة التخزين",
                    storageUsed: "مساحة التخزين المستخدمة",
                    autoCleanup: "خيارات التنظيف التلقائي",
                    deleteOldImages: "حذف الصور القديمة",
                    deleteOldCases: "إزالة الحالات الأقدم من 3 أشهر",
                    autoBackup: "النسخ الاحتياطي التلقائي",
                    cleanupStorage: "تنظيف التخزين",
                    resetData: "إعادة تعيين البيانات"
                },
                dock: {
                    addCase: "إضافة حالة",
                    samples: "عينات",
                    printReports: "طباعة التقارير",
                    excel: "Excel",
                    pdf: "PDF",
                    reset: "إعادة تعيين",
                    heatmap: "خريطة الحرارة",
                    storage: "التخزين"
                },
                modal: {
                    addCaseTitle: "إضافة حالة جديدة",
                    orderId: "رقم الطلب",
                    orderDate: "تاريخ الطلب",
                    branch: "الفرع",
                    selectBranch: "اختر الفرع",
                    platform: "المنصة",
                    selectPlatform: "اختر المنصة",
                    problemType: "نوع المشكلة",
                    selectProblem: "اختر نوع المشكلة",
                    coldFood: "طعام بارد",
                    lateDelivery: "تأخير في التوصيل",
                    missingIncorrect: "طلب خاطئ/مفقود",
                    other: "أخرى",
                    description: "وصف المشكلة",
                    evidence: "الأدلة (صور، روابط)",
                    evidencePlaceholder: "أدخل رابط الصورة أو الوصف",
                    compensation: "قيمة التعويض (AED)",
                    recovered: "المبلغ المسترد (AED)",
                    cancel: "إلغاء",
                    save: "حفظ الحالة"
                }
            },
            en: {
                title: "Compensation Ticket Management System - Crispy Chicken",
                header: {
                    title: "Compensation Ticket Management System",
                    brand: "Crispy Chicken"
                },
                sidebar: {
                    dashboard: "Dashboard",
                    cases: "Cases Management",
                    platform: "Platform Analysis",
                    branch: "Branch Analysis",
                    summaries: "Summaries",
                    settings: "Settings"
                },
                dashboard: {
                    title: "Dashboard",
                    totalCases: "Total Cases",
                    totalCompensation: "Total Compensation",
                    rejectionRate: "Rejection Rate",
                    recovered: "Recovered Amounts",
                    categoryChart: "Cases Distribution by Category",
                    branchChart: "Cases Distribution by Branch",
                    trendChart: "Monthly Trend"
                },
                cases: {
                    title: "Cases Management",
                    addNew: "Add New Case",
                    search: "Search...",
                    allBranches: "All Branches",
                    allStatuses: "All Cases",
                    allCategories: "All Categories",
                    statusNew: "New",
                    statusOpen: "Open",
                    statusSent: "Sent",
                    statusClosed: "Closed",
                    statusRejected: "Rejected",
                    coldFood: "Cold Food",
                    lateDelivery: "Late Delivery",
                    missingIncorrect: "Missing/Incorrect",
                    other: "Other",
                    case1Title: "Order #12345 - Cold Food",
                    case1Branch: "Branch: Khalidiya | Platform: Noon",
                    case1Desc: "Food arrived cold after 45 minutes from order",
                    case2Title: "Order #12346 - Wrong Order",
                    case2Branch: "Branch: Al Barsha | Platform: Careem",
                    case2Desc: "Ordered fried chicken but received grilled chicken",
                    case3Title: "Order #12347 - Late Delivery",
                    case3Branch: "Branch: Muroor | Platform: Noon",
                    case3Desc: "Delivery was 30 minutes late than scheduled time",
                    recovered: "10 AED Recovered",
                    edit: "Edit",
                    delete: "Delete",
                    whatsapp: "WhatsApp"
                },
                platform: {
                    title: "Platform Analysis",
                    allPlatforms: "All Platforms",
                    noon: "Noon Platform",
                    careem: "Careem Platform",
                    totalCases: "Total Cases",
                    totalCompensation: "Total Compensation",
                    rejectionRate: "Rejection Rate",
                    categoryChart: "Cases Distribution by Category",
                    branchChart: "Cases Distribution by Branch",
                    trendChart: "Monthly Trend"
                },
                branch: {
                    title: "Branch Analysis"
                },
                summaries: {
                    title: "Summaries",
                    daily: "Daily Summary",
                    dailyUpdated: "Last Updated: Today",
                    weekly: "Weekly Summary",
                    weeklyUpdated: "Last Updated: Last Week",
                    monthly: "Monthly Summary",
                    monthlyUpdated: "Last Updated: Last Month",
                    totalCases: "Total Cases",
                    totalCompensation: "Total Compensation",
                    rejectionRate: "Rejection Rate",
                    viewDetails: "View Details",
                    dailyTrend: "Daily Cases Trend",
                    weeklyTrend: "Weekly Cases Trend",
                    monthlyTrend: "Monthly Cases Trend",
                    sendDaily: "Send Daily Summary",
                    sendWeekly: "Send Weekly Summary",
                    sendMonthly: "Send Monthly Summary"
                },
                settings: {
                    title: "Settings",
                    branchManagement: "Branch Management",
                    branch: "Branch",
                    whatsapp: "WhatsApp",
                    status: "Status",
                    actions: "Actions",
                    active: "Active",
                    edit: "Edit",
                    delete: "Delete",
                    addBranch: "Add New Branch",
                    storageManagement: "Storage Management",
                    storageUsed: "Storage Used",
                    autoCleanup: "Auto Cleanup Options",
                    deleteOldImages: "Delete Old Images",
                    deleteOldCases: "Remove Cases Older Than 3 Months",
                    autoBackup: "Auto Backup",
                    cleanupStorage: "Cleanup Storage",
                    resetData: "Reset Data"
                },
                dock: {
                    addCase: "Add Case",
                    samples: "Samples",
                    printReports: "Print Reports",
                    excel: "Excel",
                    pdf: "PDF",
                    reset: "Reset",
                    heatmap: "Heatmap",
                    storage: "Storage"
                },
                modal: {
                    addCaseTitle: "Add New Case",
                    orderId: "Order ID",
                    orderDate: "Order Date",
                    branch: "Branch",
                    selectBranch: "Select Branch",
                    platform: "Platform",
                    selectPlatform: "Select Platform",
                    problemType: "Problem Type",
                    selectProblem: "Select Problem Type",
                    coldFood: "Cold Food",
                    lateDelivery: "Late Delivery",
                    missingIncorrect: "Missing/Incorrect",
                    other: "Other",
                    description: "Problem Description",
                    evidence: "Evidence (Images, Links)",
                    evidencePlaceholder: "Enter image link or description",
                    compensation: "Compensation Value (AED)",
                    recovered: "Recovered Amount (AED)",
                    cancel: "Cancel",
                    save: "Save Case"
                }
            }
        };

        // Language Management
        let currentLanguage = localStorage.getItem('language') || 'ar';

        function updateLanguage() {
            const lang = currentLanguage;
            const html = document.documentElement;
            
            // Update HTML attributes
            html.lang = lang;
            html.dir = lang === 'ar' ? 'rtl' : 'ltr';
            
            // Update language switcher button
            document.getElementById('langSwitcher').textContent = lang === 'ar' ? 'EN' : 'AR';
            
            // Update all translatable elements
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[lang] && translations[lang][key]) {
                    element.textContent = translations[lang][key];
                }
            });
            
            // Update placeholders
            document.querySelectorAll('[data-translate-placeholder]').forEach(element => {
                const key = element.getAttribute('data-translate-placeholder');
                if (translations[lang] && translations[lang][key]) {
                    element.placeholder = translations[lang][key];
                }
            });
            
            // Update charts labels
            updateChartsLabels();
        }

        function updateChartsLabels() {
            // This function would update chart labels based on current language
            // For simplicity, we'll just reinitialize charts
            if (document.getElementById('dashboard-page').style.display !== 'none') {
                setTimeout(initCharts, 100);
            }
        }

        // Language switcher event
        document.getElementById('langSwitcher').addEventListener('click', () => {
            currentLanguage = currentLanguage === 'ar' ? 'en' : 'ar';
            localStorage.setItem('language', currentLanguage);
            updateLanguage();
        });

        // Notification System
        class NotificationSystem {
            constructor() {
                this.container = document.getElementById('notificationContainer');
                this.notifications = [];
            }
            
            show(message, type = 'info', duration = 5000) {
                const id = Date.now();
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.id = `notification-${id}`;
                
                const icons = {
                    success: 'bi-check-circle-fill text-success',
                    error: 'bi-x-circle-fill text-danger',
                    warning: 'bi-exclamation-triangle-fill text-warning',
                    info: 'bi-info-circle-fill text-primary'
                };
                
                notification.innerHTML = `
                    <i class="bi ${icons[type]} notification-icon"></i>
                    <div class="notification-message">${message}</div>
                    <div class="notification-close" onclick="notificationSystem.remove(${id})">×</div>
                `;
                
                this.container.appendChild(notification);
                this.notifications.push({ id, element: notification });
                
                setTimeout(() => {
                    this.remove(id);
                }, duration);
            }
            
            remove(id) {
                const index = this.notifications.findIndex(n => n.id === id);
                if (index !== -1) {
                    this.notifications[index].element.remove();
                    this.notifications.splice(index, 1);
                }
            }
        }
        
        const notificationSystem = new NotificationSystem();
        
        // Initialize Charts
        function initCharts() {
            // Category Distribution Chart
            const categoryCtx = document.getElementById('categoryChart');
            if (categoryCtx) {
                const labels = currentLanguage === 'ar' 
                    ? ['طعام بارد', 'تأخير في التوصيل', 'طلب خاطئ/مفقود', 'أخرى']
                    : ['Cold Food', 'Late Delivery', 'Missing/Incorrect', 'Other'];
                
                new Chart(categoryCtx, {
                    type: 'pie',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: [45, 30, 15, 10],
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.7)',
                                'rgba(54, 162, 235, 0.7)',
                                'rgba(255, 206, 86, 0.7)',
                                'rgba(75, 192, 192, 0.7)'
                            ],
                            borderColor: [
                                'rgba(255, 99, 132, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 206, 86, 1)',
                                'rgba(75, 192, 192, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: currentLanguage === 'ar' ? 'left' : 'right'
                            }
                        }
                    }
                });
            }
            
            // Branch Distribution Chart
            const branchCtx = document.getElementById('branchChart');
            if (branchCtx) {
                const label = currentLanguage === 'ar' ? 'عدد الحالات' : 'Number of Cases';
                
                new Chart(branchCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Khalidiya', 'Muroor', 'Shabiya 11', 'Al Barsha', 'Al Satwa', 'Electra', 'Hamdan'],
                        datasets: [{
                            label: label,
                            data: [25, 18, 22, 30, 15, 20, 12],
                            backgroundColor: 'rgba(255, 107, 53, 0.7)',
                            borderColor: 'rgba(255, 107, 53, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
            
            // Monthly Trend Chart
            const trendCtx = document.getElementById('trendChart');
            if (trendCtx) {
                const casesLabel = currentLanguage === 'ar' ? 'الحالات' : 'Cases';
                const compensationLabel = currentLanguage === 'ar' ? 'التعويضات' : 'Compensation';
                const months = currentLanguage === 'ar' 
                    ? ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو']
                    : ['January', 'February', 'March', 'April', 'May', 'June'];
                
                new Chart(trendCtx, {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: [{
                            label: casesLabel,
                            data: [65, 75, 70, 85, 90, 95],
                            borderColor: 'rgba(255, 107, 53, 1)',
                            backgroundColor: 'rgba(255, 107, 53, 0.1)',
                            fill: true
                        }, {
                            label: compensationLabel,
                            data: [25, 30, 28, 35, 38, 40],
                            borderColor: 'rgba(54, 162, 235, 1)',
                            backgroundColor: 'rgba(54, 162, 235, 0.1)',
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
            
            // Platform Charts
            const platformCategoryCtx = document.getElementById('platform-categoryChart');
            if (platformCategoryCtx) {
                const labels = currentLanguage === 'ar' 
                    ? ['طعام بارد', 'تأخير في التوصيل', 'طلب خاطئ/مفقود', 'أخرى']
                    : ['Cold Food', 'Late Delivery', 'Missing/Incorrect', 'Other'];
                
                new Chart(platformCategoryCtx, {
                    type: 'pie',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: [45, 30, 15, 10],
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.7)',
                                'rgba(54, 162, 235, 0.7)',
                                'rgba(255, 206, 86, 0.7)',
                                'rgba(75, 192, 192, 0.7)'
                            ],
                            borderColor: [
                                'rgba(255, 99, 132, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 206, 86, 1)',
                                'rgba(75, 192, 192, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: currentLanguage === 'ar' ? 'left' : 'right'
                            }
                        }
                    }
                });
            }
            
            const platformBranchCtx = document.getElementById('platform-branchChart');
            if (platformBranchCtx) {
                const label = currentLanguage === 'ar' ? 'عدد الحالات' : 'Number of Cases';
                
                new Chart(platformBranchCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Khalidiya', 'Muroor', 'Shabiya 11', 'Al Barsha', 'Al Satwa', 'Electra', 'Hamdan'],
                        datasets: [{
                            label: label,
                            data: [25, 18, 22, 30, 15, 20, 12],
                            backgroundColor: 'rgba(255, 107, 53, 0.7)',
                            borderColor: 'rgba(255, 107, 53, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
            
            const platformTrendCtx = document.getElementById('platform-trendChart');
            if (platformTrendCtx) {
                const casesLabel = currentLanguage === 'ar' ? 'الحالات' : 'Cases';
                const compensationLabel = currentLanguage === 'ar' ? 'التعويضات' : 'Compensation';
                const months = currentLanguage === 'ar' 
                    ? ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو']
                    : ['January', 'February', 'March', 'April', 'May', 'June'];
                
                new Chart(platformTrendCtx, {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: [{
                            label: casesLabel,
                            data: [65, 75, 70, 85, 90, 95],
                            borderColor: 'rgba(255, 107, 53, 1)',
                            backgroundColor: 'rgba(255, 107, 53, 0.1)',
                            fill: true
                        }, {
                            label: compensationLabel,
                            data: [25, 30, 28, 35, 38, 40],
                            borderColor: 'rgba(54, 162, 235, 1)',
                            backgroundColor: 'rgba(54, 162, 235, 0.1)',
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
            
            // Summary Charts
            const dailyTrendCtx = document.getElementById('dailyTrendChart');
            if (dailyTrendCtx) {
                const label = currentLanguage === 'ar' ? 'الحالات' : 'Cases';
                const days = currentLanguage === 'ar' 
                    ? ['السبت', 'الأحد', 'الإثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة']
                    : ['Saturday', 'Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
                
                new Chart(dailyTrendCtx, {
                    type: 'bar',
                    data: {
                        labels: days,
                        datasets: [{
                            label: label,
                            data: [12, 15, 18, 14, 16, 20, 22],
                            backgroundColor: 'rgba(255, 107, 53, 0.7)',
                            borderColor: 'rgba(255, 107, 53, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
            
            const weeklyTrendCtx = document.getElementById('weeklyTrendChart');
            if (weeklyTrendCtx) {
                const label = currentLanguage === 'ar' ? 'الحالات' : 'Cases';
                const weeks = currentLanguage === 'ar' 
                    ? ['الأسبوع 1', 'الأسبوع 2', 'الأسبوع 3', 'الأسبوع 4']
                    : ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
                
                new Chart(weeklyTrendCtx, {
                    type: 'line',
                    data: {
                        labels: weeks,
                        datasets: [{
                            label: label,
                            data: [98, 105, 92, 110],
                            borderColor: 'rgba(255, 107, 53, 1)',
                            backgroundColor: 'rgba(255, 107, 53, 0.1)',
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
            
            const monthlyTrendCtx = document.getElementById('monthlyTrendChart');
            if (monthlyTrendCtx) {
                const label = currentLanguage === 'ar' ? 'الحالات' : 'Cases';
                const months = currentLanguage === 'ar' 
                    ? ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو']
                    : ['January', 'February', 'March', 'April', 'May', 'June'];
                
                new Chart(monthlyTrendCtx, {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: [{
                            label: label,
                            data: [425, 480, 450, 520, 490, 510],
                            borderColor: 'rgba(255, 107, 53, 1)',
                            backgroundColor: 'rgba(255, 107, 53, 0.1)',
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
        }
        
        // Smart Dock System
        class SmartDock {
            constructor() {
                this.dock = document.getElementById('smartDock');
                this.isOpen = false;
                this.setupEventListeners();
            }
            
            setupEventListeners() {
                // Toggle dock visibility
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'd' || e.key === 'D') {
                        this.toggle();
                    }
                });
                
                // Close dock when clicking outside
                document.addEventListener('click', (e) => {
                    if (!this.dock.contains(e.target) && this.isOpen) {
                        this.close();
                    }
                });
                
                // Handle dock actions
                document.querySelectorAll('.dock-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        const action = e.target.getAttribute('data-action');
                        this.handleAction(action);
                    });
                });
            }
            
            toggle() {
                if (this.isOpen) {
                    this.close();
                } else {
                    this.open();
                }
            }
            
            open() {
                this.dock.style.display = 'flex';
                this.isOpen = true;
            }
            
            close() {
                this.dock.style.display = 'none';
                this.isOpen = false;
            }
            
            handleAction(action) {
                const messages = {
                    'add-case': currentLanguage === 'ar' 
                        ? 'فتح نموذج إضافة حالة جديدة...' 
                        : 'Opening new case form...',
                    'export-excel': currentLanguage === 'ar' 
                        ? 'جاري تصدير البيانات إلى Excel...' 
                        : 'Exporting data to Excel...',
                    'export-pdf': currentLanguage === 'ar' 
                        ? 'جاري تصدير البيانات إلى PDF...' 
                        : 'Exporting data to PDF...',
                    'reset': currentLanguage === 'ar' 
                        ? 'هل أنت متأكد من إعادة تعيين البيانات؟' 
                        : 'Are you sure you want to reset data?',
                    'storage': currentLanguage === 'ar' 
                        ? 'فتح إدارة التخزين...' 
                        : 'Opening storage management...'
                };
                
                switch(action) {
                    case 'add-case':
                        const addCaseModal = new bootstrap.Modal(document.getElementById('addCaseModal'));
                        addCaseModal.show();
                        break;
                    case 'export-excel':
                    case 'export-pdf':
                    case 'storage':
                        notificationSystem.show(messages[action], 'info');
                        break;
                    case 'reset':
                        if (confirm(messages[action])) {
                            notificationSystem.show(
                                currentLanguage === 'ar' ? 'تمت إعادة تعيين البيانات بنجاح' : 'Data reset successfully', 
                                'success'
                            );
                        }
                        break;
                    default:
                        notificationSystem.show(
                            currentLanguage === 'ar' ? 'الميزة قيد التطوير' : 'Feature under development', 
                            'warning'
                        );
                }
            }
        }
        
        const smartDock = new SmartDock();
        
        // Navigation
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const page = e.currentTarget.getAttribute('data-page');
                showPage(page);
                
                // Update active nav
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                e.currentTarget.classList.add('active');
            });
        });
        
        function showPage(pageName) {
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(page => {
                page.style.display = 'none';
            });
            
            // Show selected page
            document.getElementById(`${pageName}-page`).style.display = 'block';
            
            // Initialize charts if dashboard
            if (pageName === 'dashboard') {
                setTimeout(initCharts, 100);
            }
            
            // Initialize branch analysis
            if (pageName === 'branch-analysis') {
                initBranchAnalysis();
            }
            
            // Initialize platform analysis
            if (pageName === 'platform-analysis') {
                initPlatformAnalysis();
            }
        }
        
        // Sidebar Toggle for Mobile
        document.getElementById('toggleSidebar').addEventListener('click', () => {
            document.getElementById('sidebar').classList.toggle('show');
        });
        
        // Add Case Form
        document.getElementById('addCaseBtn').addEventListener('click', () => {
            const addCaseModal = new bootstrap.Modal(document.getElementById('addCaseModal'));
            addCaseModal.show();
        });
        
        document.getElementById('saveCaseBtn').addEventListener('click', () => {
            const form = document.getElementById('addCaseForm');
            if (form.checkValidity()) {
                // Simulate saving case
                notificationSystem.show(
                    currentLanguage === 'ar' ? 'تمت إضافة الحالة بنجاح' : 'Case added successfully', 
                    'success'
                );
                bootstrap.Modal.getInstance(document.getElementById('addCaseModal')).hide();
                form.reset();
            } else {
                form.reportValidity();
            }
        });
        
        // Filters
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            filterCases(searchTerm);
        });
        
        document.getElementById('branchFilter').addEventListener('change', (e) => {
            filterCases('', e.target.value);
        });
        
        document.getElementById('statusFilter').addEventListener('change', (e) => {
            filterCases('', '', e.target.value);
        });
        
        document.getElementById('categoryFilter').addEventListener('change', (e) => {
            filterCases('', '', '', e.target.value);
        });
        
        function filterCases(search = '', branch = '', status = '', category = '') {
            const cases = document.querySelectorAll('.case-card');
            cases.forEach(caseCard => {
                const text = caseCard.textContent.toLowerCase();
                const branchText = caseCard.querySelector('.text-muted').textContent;
                const statusElement = caseCard.querySelector('.case-status');
                const statusText = statusElement ? statusElement.textContent : '';
                const categoryText = caseCard.querySelector('h5').textContent;
                
                const matchesSearch = search === '' || text.includes(search);
                const matchesBranch = branch === '' || branchText.includes(branch);
                const matchesStatus = status === '' || statusText.includes(status);
                const matchesCategory = category === '' || categoryText.includes(category);
                
                if (matchesSearch && matchesBranch && matchesStatus && matchesCategory) {
                    caseCard.style.display = 'block';
                } else {
                    caseCard.style.display = 'none';
                }
            });
        }
        
        // WhatsApp Integration
        document.querySelectorAll('.whatsapp-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const caseId = e.currentTarget.getAttribute('data-case-id');
                sendWhatsAppMessage(caseId);
            });
        });
        
        function sendWhatsAppMessage(caseId) {
            // Simulate WhatsApp message
            const message = currentLanguage === 'ar' 
                ? `تفاصيل الحالة #${caseId}\n\n` +
                  `الطلب: #${caseId}\n` +
                  `الفرع: Khalidiya\n` +
                  `المنصة: Noon\n` +
                  `الوصف: الطعام وصل بارداً بعد 45 دقيقة من الطلب\n` +
                  `القيمة: 50 AED\n` +
                  `الحالة: جديدة\n\n` +
                  `يرجى الرد على هذه الرسالة للتعامل مع الحالة.`
                : `Case Details #${caseId}\n\n` +
                  `Order: #${caseId}\n` +
                  `Branch: Khalidiya\n` +
                  `Platform: Noon\n` +
                  `Description: Food arrived cold after 45 minutes from order\n` +
                  `Value: 50 AED\n` +
                  `Status: New\n\n` +
                  `Please reply to this message to handle the case.`;
            
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/+971569494764?text=${encodedMessage}`;
            
            // Open WhatsApp in new tab
            window.open(whatsappUrl, '_blank');
            
            notificationSystem.show(
                currentLanguage === 'ar' ? 'تم فتح واتساب لإرسال رسالة' : 'WhatsApp opened to send message', 
                'success'
            );
        }
        
        // Platform Analysis
        function initPlatformAnalysis() {
            // Platform tabs
            document.querySelectorAll('.platform-tab').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    document.querySelectorAll('.platform-tab').forEach(t => t.classList.remove('active'));
                    e.currentTarget.classList.add('active');
                    
                    const platform = e.currentTarget.getAttribute('data-platform');
                    updatePlatformAnalysis(platform);
                });
            });
            
            // Initialize with all platforms
            updatePlatformAnalysis('all');
        }
        
        function updatePlatformAnalysis(platform) {
            // Simulate data based on platform
            let data = {
                all: {
                    totalCases: 142,
                    caseChange: 12,
                    totalCompensation: 24560,
                    compensationChange: 8,
                    rejectionRate: 32,
                    rejectionChange: 5
                },
                Noon: {
                    totalCases: 85,
                    caseChange: 15,
                    totalCompensation: 16800,
                    compensationChange: 10,
                    rejectionRate: 28,
                    rejectionChange: 3
                },
                Careem: {
                    totalCases: 57,
                    caseChange: 8,
                    totalCompensation: 7760,
                    compensationChange: 5,
                    rejectionRate: 35,
                    rejectionChange: 7
                }
            };
            
            const currentData = data[platform];
            
            // Update KPIs
            document.getElementById('platform-total-cases').textContent = currentData.totalCases;
            document.getElementById('platform-case-change').textContent = `+${currentData.caseChange}%`;
            document.getElementById('platform-total-compensation').textContent = `${currentData.totalCompensation.toLocaleString()} AED`;
            document.getElementById('platform-compensation-change').textContent = `+${currentData.compensationChange}%`;
            document.getElementById('platform-rejection-rate').textContent = `${currentData.rejectionRate}%`;
            document.getElementById('platform-rejection-change').textContent = `+${currentData.rejectionChange}%`;
            
            // Update charts
            initCharts(); // Reinitialize charts with new data
        }
        
        // Branch Analysis
        function initBranchAnalysis() {
            const branches = [
                { name: 'Khalidiya', phone: '+971 56 949 4764', cases: 25, recovered: 15, remaining: 10, totalCompensation: 1250, totalRejected: 750 },
                { name: 'Muroor', phone: '+971 50 541 4641', cases: 18, recovered: 12, remaining: 6, totalCompensation: 900, totalRejected: 540 },
                { name: 'Shabiya 11', phone: '+971 56 269 0688', cases: 22, recovered: 16, remaining: 6, totalCompensation: 1100, totalRejected: 660 },
                { name: 'Al Barsha', phone: '+971 56 965 9524', cases: 30, recovered: 20, remaining: 10, totalCompensation: 1500, totalRejected: 900 },
                { name: 'Al Satwa', phone: '+971 56 797 0685', cases: 15, recovered: 10, remaining: 5, totalCompensation: 750, totalRejected: 450 },
                { name: 'Electra', phone: '+971 56 386 6859', cases: 20, recovered: 15, remaining: 5, totalCompensation: 1000, totalRejected: 600 },
                { name: 'Hamdan', phone: '+971 55 688 6650', cases: 12, recovered: 8, remaining: 4, totalCompensation: 600, totalRejected: 360 }
            ];
            
            const container = document.getElementById('branchAnalysisList');
            container.innerHTML = '';
            
            const labels = currentLanguage === 'ar' 
                ? {
                    totalCases: 'إجمالي الحالات',
                    recovered: 'المسترجعة',
                    remaining: 'المتبقية',
                    totalCompensation: 'إجمالي التعويضات',
                    totalRejected: 'الرفض',
                    recoveredPercent: 'مسترجعة',
                    details: 'عرض التفاصيل',
                    whatsapp: 'واتساب'
                }
                : {
                    totalCases: 'Total Cases',
                    recovered: 'Recovered',
                    remaining: 'Remaining',
                    totalCompensation: 'Total Compensation',
                    totalRejected: 'Rejection',
                    recoveredPercent: 'Recovered',
                    details: 'View Details',
                    whatsapp: 'WhatsApp'
                };
            
            branches.forEach(branch => {
                const branchCard = document.createElement('div');
                branchCard.className = 'branch-analysis';
                branchCard.innerHTML = `
                    <div class="branch-header">
                        <h4>${branch.name}</h4>
                        <span class="badge bg-primary">${branch.phone}</span>
                    </div>
                    <div class="branch-stats">
                        <div class="branch-stat">
                            <div class="branch-stat-value">${branch.cases}</div>
                            <div class="branch-stat-label">${labels.totalCases}</div>
                        </div>
                        <div class="branch-stat">
                            <div class="branch-stat-value">${branch.recovered}</div>
                            <div class="branch-stat-label">${labels.recovered}</div>
                        </div>
                        <div class="branch-stat">
                            <div class="branch-stat-value">${branch.remaining}</div>
                            <div class="branch-stat-label">${labels.remaining}</div>
                        </div>
                        <div class="branch-stat">
                            <div class="branch-stat-value">${branch.totalCompensation} AED</div>
                            <div class="branch-stat-label">${labels.totalCompensation}</div>
                        </div>
                        <div class="branch-stat">
                            <div class="branch-stat-value">${branch.totalRejected} AED</div>
                            <div class="branch-stat-label">${labels.totalRejected}</div>
                        </div>
                    </div>
                    <div class="progress mb-3" style="height: 25px;">
                        <div class="progress-bar bg-success" role="progressbar" style="width: ${(branch.recovered / branch.cases * 100)}%">
                            ${Math.round(branch.recovered / branch.cases * 100)}% ${labels.recoveredPercent}
                        </div>
                    </div>
                    <div class="d-flex justify-content-between">
                        <button class="btn btn-sm btn-primary">${labels.details}</button>
                        <button class="btn btn-sm btn-success whatsapp-btn" data-branch="${branch.name}">
                            <i class="bi bi-whatsapp"></i> ${labels.whatsapp}
                        </button>
                    </div>
                `;
                container.appendChild(branchCard);
            });
            
            // Add WhatsApp functionality for branch analysis
            document.querySelectorAll('#branchAnalysisList .whatsapp-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const branchName = e.currentTarget.getAttribute('data-branch');
                    sendBranchWhatsAppMessage(branchName);
                });
            });
        }
        
        function sendBranchWhatsAppMessage(branchName) {
            const message = currentLanguage === 'ar' 
                ? `ملخص مطعم ${branchName}\n\n` +
                  `إجمالي الحالات: 25\n` +
                  `المسترجعة: 15\n` +
                  `المتبقية: 10\n` +
                  `إجمالي التعويضات: 1,250 AED\n` +
                  `الرفض: 750 AED\n\n` +
                  `يرجى الرد على هذه الرسالة للاطلاع على التفاصيل.`
                : `${branchName} Branch Summary\n\n` +
                  `Total Cases: 25\n` +
                  `Recovered: 15\n` +
                  `Remaining: 10\n` +
                  `Total Compensation: 1,250 AED\n` +
                  `Rejection: 750 AED\n\n` +
                  `Please reply to this message for details.`;
            
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/+971569494764?text=${encodedMessage}`;
            
            window.open(whatsappUrl, '_blank');
            
            notificationSystem.show(
                currentLanguage === 'ar' ? 'تم فتح واتساب لإرسال ملخص المطعم' : 'WhatsApp opened to send branch summary', 
                'success'
            );
        }
        
        // Summary Management
        document.getElementById('sendDailySummary').addEventListener('click', () => {
            sendSummary('daily');
        });
        
        document.getElementById('sendWeeklySummary').addEventListener('click', () => {
            sendSummary('weekly');
        });
        
        document.getElementById('sendMonthlySummary').addEventListener('click', () => {
            sendSummary('monthly');
        });
        
        function sendSummary(type) {
            const summaryData = {
                daily: {
                    title: currentLanguage === 'ar' ? 'ملخص يومي' : 'Daily Summary',
                    date: new Date().toLocaleDateString(currentLanguage === 'ar' ? 'ar-SA' : 'en-US'),
                    cases: 15,
                    compensation: 2450,
                    rejectionRate: 25
                },
                weekly: {
                    title: currentLanguage === 'ar' ? 'ملخص أسبوعي' : 'Weekly Summary',
                    date: currentLanguage === 'ar' ? 'الأسبوع الماضي' : 'Last Week',
                    cases: 98,
                    compensation: 16320,
                    rejectionRate: 30
                },
                monthly: {
                    title: currentLanguage === 'ar' ? 'ملخص شهري' : 'Monthly Summary',
                    date: currentLanguage === 'ar' ? 'الشهر الماضي' : 'Last Month',
                    cases: 425,
                    compensation: 72450,
                    rejectionRate: 28
                }
            };
            
            const data = summaryData[type];
            const message = currentLanguage === 'ar' 
                ? `${data.title}\n\n` +
                  `التاريخ: ${data.date}\n` +
                  `إجمالي الحالات: ${data.cases}\n` +
                  `إجمالي التعويضات: ${data.compensation.toLocaleString()} AED\n` +
                  `معدل الرفض: ${data.rejectionRate}%\n\n` +
                  `يرجى الاطلاع على التفاصيل في النظام.`
                : `${data.title}\n\n` +
                  `Date: ${data.date}\n` +
                  `Total Cases: ${data.cases}\n` +
                  `Total Compensation: ${data.compensation.toLocaleString()} AED\n` +
                  `Rejection Rate: ${data.rejectionRate}%\n\n` +
                  `Please check the system for details.`;
            
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/+971569494764?text=${encodedMessage}`;
            
            window.open(whatsappUrl, '_blank');
            
            notificationSystem.show(
                currentLanguage === 'ar' ? `تم إرسال ${data.title} بنجاح` : `${data.title} sent successfully`, 
                'success'
            );
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Set initial language
            updateLanguage();
            
            // Show dashboard by default
            showPage('dashboard');
            
            // Show welcome notification
            setTimeout(() => {
                notificationSystem.show(
                    currentLanguage === 'ar' ? 'مرحباً بك في نظام إدارة تذاكر التعويض' : 'Welcome to Compensation Ticket Management System', 
                    'success'
                );
            }, 500);
        });
    </script>
</body>
</html>
